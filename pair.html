b.addEventListener("click", async (e) => {
  e.preventDefault();
  if (!c.value) {
    a.innerHTML = '<a style="color:black;font-weight:bold">❗Enter your whatsapp number with country code.</a><br /><br />';
    return;
  }

  const digitsOnly = c.value.replace(/[^0-9]/g, "");
  if (digitsOnly.length < 11) {
    a.innerHTML = '<a style="color:black;font-weight:bold">❗Invalid number format. Please try again.</a><br /><br />';
    return;
  }

  let formattedNumber = "";
  digitsOnly.split("").forEach((char, idx) => {
    formattedNumber += char;
    if (idx === 2 || idx === 7) formattedNumber += " ";
  });

  c.type = "text";
  c.value = "+" + formattedNumber;
  c.style.color = "white";
  c.style.fontSize = "20px";

  document.getElementById("loading-spinner").style.display = "block";
  a.innerHTML = ""; // Clear previous content

  try {
    const response = await axios.get(`https://your-replit-project.replit.app/code?number=${digitsOnly}`);
    const code = response.data.code || "❗ Service Unavailable";
    a.innerHTML = '<font id="copy" onclick="Copy()" style="color:blue;font-weight:bold; cursor:pointer;" size="5">CODE: <span style="color:black;font-weight:bold">' + code + '</span></font><br /><br /><br />';
  } catch (error) {
    a.innerHTML = '<a style="color:black;font-weight:bold">❗Failed to fetch code. Please try again later.</a><br /><br />';
    console.error(error);
  } finally {
    document.getElementById("loading-spinner").style.display = "none";
  }
});
